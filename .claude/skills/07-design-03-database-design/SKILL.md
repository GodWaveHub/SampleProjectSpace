---
name: 07-design-03-database-design
description: Instructions for creating file and table design documents (File/Table Design).
---

# ファイル・テーブル設計書作成時の指示
- ファイル・テーブル設計書作成時は、以下のルールに従ってドキュメントを作成してください。
- データベース（RDBMS/NoSQL）、ファイル、メモリ上のデータ構造など、データの永続化や構造に関する設計を含みます。
- フォーマットは./assetsを参照してください。

## 作成するドキュメントの種類
以下の項目について、必要に応じて設計書を作成してください。

1. **テーブル定義（カラム、型、制約）**
2. **インデックス設計**
3. **マスタデータ仕様**
4. **ファイル仕様（CSV/JSON など）**
5. **モジュール単位のローカルデータ構造**
6. **DTO / VO / Entity のフィールド仕様**
7. **NOSQL定義書**

## 共通ルール
- ドキュメントは `07_Design/03_DatabaseDesign` フォルダに作成してください。
- すべての定義書を整理して掲載したHTMLを作成してください。ファイル名は `index.html` とし、各設計書へのリンクや概要を掲載してください。

## 各ドキュメントの詳細ルール

### テーブル定義（カラム、型、制約）
- RDBMSを利用する場合に作成してください。
- ファイル名: `{tablename}_Table_Definition.md`
- 記載項目:
    - テーブル物理名、論理名
    - カラム一覧（No, 物理名, 論理名, データ型, NULL許容, デフォルト値, PK, FK, 備考）
    - 制約一覧（PK, FK, UNIQUE, CHECK等）
- 命名規則:
    - テーブル名: `機能略称_テーブル用途`（例: PRJ_USER_ACCOUNT）
    - カラム名: `小文字のスネークケース`（例: user_id, created_at）

### 2. インデックス設計
- パフォーマンス要件に基づいてインデックスを設計してください。
- ファイル名: `{tablename}_Index_Definition.md`
- 記載項目:
    - インデックス名
    - 対象テーブル
    - 対象カラム（順序含む）
    - インデックスの種類（B-Tree, Hash等）
    - ユニーク制約の有無
- 命名規則:
    - インデックス名: `idx_テーブル名_カラム名`（例: idx_user_account_user_id）
- フォーマット: `80_formats/index_definition_format.md` を参照してください。

### 3. マスタデータ仕様
- システムで利用する固定値や設定値を定義してください。
- ファイル名: `Master_Data_Specification.md` または個別のマスタ定義書
- 記載項目:
    - マスタ名
    - 用途
    - データ構造
    - 具体的なデータ値（初期データ）

### 4. ファイル仕様（CSV/JSON など）
- 外部システム連携やログ出力、設定ファイルなどで使用するファイルの仕様を定義してください。
- ファイル名: `{filename}_File_Specification.md`
- 記載項目:
    - ファイル名（命名規則）
    - ファイル形式（CSV, JSON, XML, TSV, 固定長など）
    - 文字コード、改行コード
    - ディレクトリ構成
    - 項目定義（フィールド名、型、桁数、必須、説明）

### 5. モジュール単位のローカルデータ構造
- 特定のモジュールやコンポーネント内で使用される複雑なデータ構造を定義してください。
- ファイル名: `{module_name}_Local_Data_Structure.md`
- 記載項目:
    - データ構造名
    - 利用箇所
    - 構造定義（クラス図やJSONスキーマ等で表現）

### 6. DTO / VO / Entity のフィールド仕様
- アプリケーション内部でデータを保持・転送するためのオブジェクト仕様を定義してください。
- ファイル名: `Data_Transfer_Objects.md` またはクラスごとの定義書
- 記載項目:
    - クラス名 / インターフェース名
    - パッケージ / 名前空間
    - フィールド一覧（型、名称、説明、バリデーションルール）

### 7. NOSQL定義書
- Firestore, MongoDB, RedisなどのNoSQLデータベースを利用する場合に作成してください。
- ファイル名: `NoSQL_Definition.md` またはコレクション/ドキュメントごとの定義書
- 記載項目:
    - コレクション / キーの設計
    - ドキュメント構造（JSON形式などで階層構造を表現）
    - データ型
    - インデックス設定
    - セキュリティルール（Firestore Security Rules等）

## UMLの作成
- Mermaid記法を用いて図解を作成してください。
    - ER図（`ER_Diagram.mmd`）: テーブル間のリレーションを表現
    - クラス図: DTO/Entityの関係を表現
- 作成したUMLはHTMLに掲載してください。

## カラム論理名に関するルール（全般）
- すべての項目には物理名（英語）と論理名（日本語）を必ず設定してください。
- 論理名は業務上の意味を理解しやすい日本語名称を使用してください。
